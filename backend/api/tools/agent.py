
from context_building import build_context

class Agent:
  fixed_questions:list[dict] = None
  models:dict = None

  def __init__(self, fixed_questions):
    self.fixed_questions = fixed_questions
    self.models = define_models()
  
  def forward(self, body: list[dict]) -> list[dict]:
    """
    Processes the input body and returns a response based on the agent's logic.

    Args:
        body (list[dict]): The input body containing user messages and other relevant information.

    Returns:
        list[dict]: The response generated by the agent.
    """
    # Here you would implement the logic to process the body and generate a response
    anthropified_body = anthropify_body(body)
    print("Anthropified body:", anthropified_body)
    context = build_context(anthropified_body)
    print("Context built:", context)
    raise  NotImplementedError("The forward method needs to be implemented.")

agent = Agent()

def init_agent(fixed_questions: list[dict]):
  agent.__init__(fixed_questions)

def define_models() -> dict:
  return

def anthropify_body(body: list[dict]) -> list[dict]:
    """
    Converts the body to a format suitable for anthropic models.
    """
    new_body = []
    if body[0]["balise"] == "user":
      new_body = [{"role": "assistant", "content": "I'm here to help you with your questions."}]
    for message in body:
        if message["balise"] == "user":
            if len(new_body)==0 or new_body[-1]["role"] == "assistant":
               new_body.append({"role": "user", "content": message["content"]})
            else:
               new_body[-1]["content"] += "\n" + message["content"]
        else:
            # If message is not from the user, include balise
            assistant_content = "### " + message["balise"] + " ###\n" + message["content"]
            if len(new_body)==0 or new_body[-1]["role"] == "user":
                new_body.append({"role": "assistant", "content": assistant_content})
            else:
                new_body[-1]["content"] += "\n" + assistant_content

    return new_body